<!DOCTYPE html><html lang="zh-Hans" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width,initial-scale=1"><title>基于R的球员身价预测模型 | L1ttleQing的小站</title><meta name="keywords" content="数据科学"><meta name="author" content="L1ttleQing"><meta name="copyright" content="L1ttleQing"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#ffffff"><meta name="description" content="预测足球运动员的市场价值，使用FIFA20球员数据集，并不严谨，看一乐。">
<meta property="og:type" content="article">
<meta property="og:title" content="基于R的球员身价预测模型">
<meta property="og:url" content="http://l1ttleqing.github.io/2023/05/22/3%E5%9F%BA%E4%BA%8EFIFA20%E7%90%83%E5%91%98%E6%95%B0%E6%8D%AE%E9%A2%84%E6%B5%8B%E8%BA%AB%E4%BB%B7/index.html">
<meta property="og:site_name" content="L1ttleQing的小站">
<meta property="og:description" content="预测足球运动员的市场价值，使用FIFA20球员数据集，并不严谨，看一乐。">
<meta property="og:locale">
<meta property="og:image" content="http://l1ttleqing.github.io/img/R_FIFA.jpg">
<meta property="article:published_time" content="2023-05-22T13:09:00.000Z">
<meta property="article:modified_time" content="2024-11-27T18:13:57.725Z">
<meta property="article:author" content="L1ttleQing">
<meta property="article:tag" content="数据科学">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="http://l1ttleqing.github.io/img/R_FIFA.jpg"><link rel="shortcut icon" href="/img/favicon.png"><link rel="canonical" href="http://l1ttleqing.github.io/2023/05/22/3%E5%9F%BA%E4%BA%8EFIFA20%E7%90%83%E5%91%98%E6%95%B0%E6%8D%AE%E9%A2%84%E6%B5%8B%E8%BA%AB%E4%BB%B7/"><link rel="preconnect" href="//cdn1.tianli0.top"/><link rel="preconnect" href="//busuanzi.ibruce.info"/><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="/" media="print" onload="this.media='all'"><script>const GLOBAL_CONFIG = { 
  root: '/',
  algolia: undefined,
  localSearch: {"path":"search.xml","languages":{"hits_empty":"We didn't find any results for the search: ${query}"}},
  translate: undefined,
  noticeOutdate: undefined,
  highlight: {"plugin":"highlighjs","highlightCopy":true,"highlightLang":true},
  copy: {
    success: '复制成功',
    error: '复制错误',
    noSupport: '浏览器不支持'
  },
  relativeDate: {
    homepage: false,
    post: false
  },
  runtime: '天',
  date_suffix: {
    just: '刚刚',
    min: '分钟前',
    hour: '小时前',
    day: '天前',
    month: '个月前'
  },
  copyright: undefined,
  lightbox: 'fancybox',
  Snackbar: undefined,
  source: {
    jQuery: 'https://cdnjs.sourcegcdn.com/ajax/libs/jquery/3.6.0/jquery.min.js',
    justifiedGallery: {
      js: 'https://cdnjs.sourcegcdn.com/ajax/libs/justifiedGallery/3.8.1/js/jquery.justifiedGallery.min.js',
      css: 'https://cdnjs.sourcegcdn.com/ajax/libs/justifiedGallery/3.8.1/css/justifiedGallery.min.css'
    },
    fancybox: {
      js: 'https://cdnjs.sourcegcdn.com/ajax/libs/fancybox/3.5.7/jquery.fancybox.min.js',
      css: 'https://cdnjs.sourcegcdn.com/ajax/libs/fancybox/3.5.7/jquery.fancybox.min.css'
    }
  },
  isPhotoFigcaption: true,
  islazyload: false,
  isanchor: false
}</script><script id="config-diff">var GLOBAL_CONFIG_SITE = { 
  isPost: true,
  isHome: false,
  isHighlightShrink: false,
  isToc: true,
  postUpdate: '2024-11-28 02:13:57'
}</script><noscript><style type="text/css">
  #nav {
    opacity: 1
  }
  .justified-gallery img {
    opacity: 1
  }

  #recent-posts time,
  #post-meta time {
    display: inline !important
  }
</style></noscript><script>(win=>{
    win.saveToLocal = {
      set: function setWithExpiry(key, value, ttl) {
        if (ttl === 0) return
        const now = new Date()
        const expiryDay = ttl * 86400000
        const item = {
          value: value,
          expiry: now.getTime() + expiryDay,
        }
        localStorage.setItem(key, JSON.stringify(item))
      },

      get: function getWithExpiry(key) {
        const itemStr = localStorage.getItem(key)

        if (!itemStr) {
          return undefined
        }
        const item = JSON.parse(itemStr)
        const now = new Date()

        if (now.getTime() > item.expiry) {
          localStorage.removeItem(key)
          return undefined
        }
        return item.value
      }
    }
  
    win.getScript = url => new Promise((resolve, reject) => {
      const script = document.createElement('script')
      script.src = url
      script.async = true
      script.onerror = reject
      script.onload = script.onreadystatechange = function() {
        const loadState = this.readyState
        if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
        script.onload = script.onreadystatechange = null
        resolve()
      }
      document.head.appendChild(script)
    })
  
      win.activateDarkMode = function () {
        document.documentElement.setAttribute('data-theme', 'dark')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#0d0d0d')
        }
      }
      win.activateLightMode = function () {
        document.documentElement.setAttribute('data-theme', 'light')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#ffffff')
        }
      }
      const t = saveToLocal.get('theme')
    
          if (t === 'dark') activateDarkMode()
          else if (t === 'light') activateLightMode()
        
      const asideStatus = saveToLocal.get('aside-status')
      if (asideStatus !== undefined) {
        if (asideStatus === 'hide') {
          document.documentElement.classList.add('hide-aside')
        } else {
          document.documentElement.classList.remove('hide-aside')
        }
      }
    
    const fontSizeVal = saveToLocal.get('global-font-size')
    if (fontSizeVal !== undefined) {
      document.documentElement.style.setProperty('--global-font-size', fontSizeVal + 'px')
    }
    })(window)</script><link rel="stylesheet" href="https://cdn1.tianli0.top/npm/lxgw-wenkai-screen-webfont@1.1.0/style.css" /><script charset="UTF-8" id="LA_COLLECT" src="//sdk.51.la/js-sdk-pro.min.js"></script><script>LA.init({id:"Jws8lO85zPmXkSKj",ck:"Jws8lO85zPmXkSKj"})</script><meta name="generator" content="Hexo 6.3.0"></head><body><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="simply-cha-top"></div><div class="is-center" id="sidebar-avatar"><div class="avatar-img"><img src="/img/head_sculpture.jpg" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"/></div><div class="author-info__name">L1ttleQing</div><div class="author-info__description">越悲怆的时候我越想嬉皮</div></div><div class="site-data"><div class="data-item is-center"><div class="data-item-link"><a href="/archives/"><div class="headline">文章</div><div class="length-num">34</div></a></div></div><div class="data-item is-center"><div class="data-item-link"><a href="/tags/"><div class="headline">标签</div><div class="length-num">5</div></a></div></div><div class="data-item is-center"><div class="data-item-link"><a href="/categories/"><div class="headline">分类</div><div class="length-num">2</div></a></div></div></div><a class="button--animated" id="card-info-btn" target="_blank" rel="noopener" href="https://github.com/L1ttleQing"><i class="fab fa-github"></i><span>主页</span></a><div class="menu-info-social-icons is-center"><a class="social-icon" href="https://github.com/L1ttleQing" target="_blank" title="fab fa-github"></a><a class="social-icon" href="tencent://AddContact/?fromId=45&amp;fromSubId=1&amp;subcmd=all&amp;uin=820314438&amp;website=www.oicqzone.com" target="_blank" title="fab fa-qq"></a><a class="social-icon" href="mailto:820314438@qq.com" target="_blank" title="fas fa-envelope-open-text"></a><a class="social-icon" href="https://space.bilibili.com/26528101" target="_blank" title="fab fa-bilibili"></a><a class="social-icon" href="weixin://dl/w19183660929" target="_blank" title="fab fa-weixin"></a></div><hr/><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 主页</span></a></div><div class="menus_item"><a class="site-page" href="javascript:void(0);"><i class="fa-fw fa fa-graduation-cap"></i><span> 博文</span><i class="fas fa-chevron-down expand"></i></a><ul class="menus_item_child" style="left:-100px;"><li><a class="site-page child" href="/categories/"><i class="fa-fw fa fa-archive"></i><span> 分类</span></a></li><li><a class="site-page child" href="/tags/"><i class="fa-fw fa fa-tags"></i><span> 标签</span></a></li><li><a class="site-page child" href="/archives/"><i class="fa-fw fa fa-folder-open"></i><span> 归档</span></a></li></ul></div></div><div class="simply-cha"></div></div></div><div class="post" id="body-wrap"><header class="not-top-img" id="page-header"><nav id="nav"><div id="nav-group"><span id="blog_name"><a id="site-name" href="/">L1ttleQing的小站</a></span><div id="menus"><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 主页</span></a></div><div class="menus_item"><a class="site-page" href="javascript:void(0);"><i class="fa-fw fa fa-graduation-cap"></i><span> 博文</span><i class="fas fa-chevron-down expand"></i></a><ul class="menus_item_child" style="left:-100px;"><li><a class="site-page child" href="/categories/"><i class="fa-fw fa fa-archive"></i><span> 分类</span></a></li><li><a class="site-page child" href="/tags/"><i class="fa-fw fa fa-tags"></i><span> 标签</span></a></li><li><a class="site-page child" href="/archives/"><i class="fa-fw fa fa-folder-open"></i><span> 归档</span></a></li></ul></div></div></div><div id="navFn"><div id="search-button"><a class="social-icon search"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-sousuo"></use></svg><span> 搜索</span></a></div><div id="darkmodeBt"><a class="darkmode switch"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-deng1"></use></svg><span id="darkmode-switch"> 关灯</span></a></div><div id="toggle-menu"><a class="site-page"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-mulu"></use></svg></a></div></div></div></nav></header><div id="mainbody"><div id="content_leftside"><div id="left_menu"><div class="leftside-social"><a class="social-icon" href="https://github.com/L1ttleQing" target="_blank" title="fab fa-github"></a><a class="social-icon" href="tencent://AddContact/?fromId=45&amp;fromSubId=1&amp;subcmd=all&amp;uin=820314438&amp;website=www.oicqzone.com" target="_blank" title="fab fa-qq"></a><a class="social-icon" href="mailto:820314438@qq.com" target="_blank" title="fas fa-envelope-open-text"></a><a class="social-icon" href="https://space.bilibili.com/26528101" target="_blank" title="fab fa-bilibili"></a><a class="social-icon" href="weixin://dl/w19183660929" target="_blank" title="fab fa-weixin"></a></div><div class="leftside-contents"><span id="read-percent">0</span></div><div class="leftside-comment"><a href="#post-comment" title="要去留言吗？"><i class="fa-lg fas fa-comment"></i></a></div><div class="leftside-qq" title="来糖果屋聊天噻！"><i class="fa-lg fas fa-qrcode"></i></div><div class="leftside-rmb"><a title="柿还在施工的捐赠页！不给看！"><i class="fa-lg fas fa-money-check-dollar"></i></a></div></div><div id="left_display"><div class="candy_qrcode"><img src="./img/candy-qr.png"></div></div></div><main class="layout" id="content-inner"><div id="post"><div id="post-info"><h1 class="post-title">基于R的球员身价预测模型</h1><div id="post-meta"><div class="tag-cloud-list is-center"><a href="/tags/%E6%95%B0%E6%8D%AE%E7%A7%91%E5%AD%A6/" style="font-size: 1.5em; color: rgb(52, 158, 17)">数据科学</a></div><div class="meta-firstline"><span class="post-meta-date"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-rili"></use></svg><span class="post-meta-label">发表于</span><time class="post-meta-date-created" datetime="2023-05-22T13:09:00.000Z" title="发表于 2023-05-22 21:09:00">2023-05-22</time><span class="post-meta-separator">|</span><svg class="icon" aria-hidden="true"><use xlink:href="#icon-shijian"></use></svg><span class="post-meta-label">更新于</span><time class="post-meta-date-updated" datetime="2024-11-27T18:13:57.725Z" title="更新于 2024-11-28 02:13:57">2024-11-28</time></span><span class="post-meta-categories"><span class="post-meta-separator">|</span><svg class="icon" aria-hidden="true"><use xlink:href="#icon-fenlei1"></use></svg><a class="post-meta-categories" href="/categories/%E5%AD%A6%E4%B9%A0%E5%BF%83%E5%BE%97/">学习心得</a></span></div><div class="meta-secondline"><span class="post-meta-separator"></span><span class="post-meta-wordcount"><i class="far fa-file-word fa-fw post-meta-icon"></i><span class="post-meta-label">字数总计:</span><span class="word-count">7.5k</span><span class="post-meta-separator">|</span><i class="far fa-clock fa-fw post-meta-icon"></i><span class="post-meta-label">阅读时长:</span><span>30分钟</span></span><span class="post-meta-separator">|</span><span class="post-meta-pv-cv" id="" data-flag-title="基于R的球员身价预测模型"><i class="far fa-eye fa-fw post-meta-icon"></i><span class="post-meta-label">阅读量:</span><span id="busuanzi_value_page_pv"></span></span></div></div></div><article class="post-content" id="article-container"><h1 id="准备工作"><a href="#准备工作" class="headerlink" title="准备工作"></a>准备工作</h1><p>R语言大作业的要求是这样的：</p>
<blockquote>
<p>找到一些公共数据集，下载它们，对它们进行数据分析。<br>就分析步骤和结果写一份数据分析报告。源代码、图表必须包含在内。<br>最好演示典型的数据科学项目的整个过程，例如导入、整理、转换、可视化、建模等。</p>
</blockquote>
<p>能自己选自己要处理的数据集，那为什么不选点有意思的呢？</p>
<p>第一步的任务是找到合适的公共数据集。在数据科学网站<a target="_blank" rel="noopener" href="https://kaggle.com/">kaggle</a>上有很多质量非常高的数据集，由衷感谢每一位把自己辛辛苦苦整理好的数据集共享在网站上的数据科学工作者，你们是开源精神的真正践行者，鞠躬。</p>
<p> 我最初的设想是找世界杯数据集，分析主客队进球的差异并进行预测，如何进一步推广到比赛的胜负。接着我发现这个思路并不可靠，因为世界杯主客队的区别也就仅限于开球先后的区别，说实话影响不大。更重要的是，世界杯上的比赛随机性非常恐怖，且能挖掘的数据量并不大，都是显而易见的数据，无法深入推进。展开来说，就是足球比赛本身因为过大的随机性导致以我的水平难以建模预测。话说回来，要是任何一种比赛没有随机性，估计也就没人想看了。总之，这导致想水一篇论文的难度变得比较大。</p>
<p> 于是我们转变思路，有没有什么整理好的数据，可以量化足球这项运动呢？</p>
<p> 答案是足球游戏数值，这是现成的已经量化球员数据。</p>
<p> 所以我选用了这个<a target="_blank" rel="noopener" href="https://www.kaggle.com/datasets/stefanoleone992/fifa-20-complete-player-dataset">FIFA20数据集</a>进行建模。EA的FIFA系列年货一年一部，数据更新快，球员数量多，而且结构非常清晰，不需要过多处理就很适合用作建模的数据集。</p>
<p> 我的方向是通过球员的数据预测该球员的身价，需要用有逻辑的方法完成建模。</p>
<h1 id="初步建模"><a href="#初步建模" class="headerlink" title="初步建模"></a>初步建模</h1><h3 id="处理数据"><a href="#处理数据" class="headerlink" title="处理数据"></a>处理数据</h3><p> 根据作业要求，我们使用R语言。</p>
<p> 拿到一个数据集，第一件事肯定是先看看这个数据集的结构，连数据集里面有什么都不知道还怎么下手？所以我们现在的当务之急就是把刚下好的新鲜数据集导入RStuido进行处理。</p>
<p> 查看和设置RStudio的工作路径：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">getwd()</span><br><span class="line">setwd(&quot;E:/FIFA 20&quot;)</span><br></pre></td></tr></table></figure>

<p> 如果数据集已经被放在工作路径，可以输入相对路径打开，<br> 如果数据集没有被放在工作路径，可以输入绝对路径打开。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">data &lt;- read.csv(&quot;FIFA20.csv&quot;)</span><br><span class="line">data &lt;- read.csv(&quot;E:/FIFA 20/FIFA20.csv&quot;)</span><br></pre></td></tr></table></figure>

<p>然后导入需要用的包：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">library(tidyverse) </span><br><span class="line">library (corrplot)</span><br><span class="line">library(caret)</span><br><span class="line">library(rpart)</span><br></pre></td></tr></table></figure>
<ul>
<li>tidyverse 数据可视化的集成包，包含了ggplot2等包，有助于进行可视化、建模等任务。</li>
<li>corrplot 于绘制相关系数矩阵的 R 包，提供了多种可视化相关系数矩阵的方法。</li>
<li>caret 用于分类、回归和聚类等的包，可以完成数据预处理、特征选择、模型训练、模型评估等任务。</li>
<li>rpart 用于决策树建模的 R 包</li>
</ul>
<p>在成功导入后，输入下列代码查看数据集基本情况：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">summary(data)</span><br></pre></td></tr></table></figure>
<p>由于这个数据集里东西太多，出现了海量的数据，如下：</p>
<details>
    
<summary>点击展开/收缩代码块</summary>
    
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><span class="line">sofifa_id       player_url         short_name         long_name              age            dob              height_cm    </span><br><span class="line"> Min.   :   768   Length:18278       Length:18278       Length:18278       Min.   :16.00   Length:18278       Min.   :156.0  </span><br><span class="line"> 1st Qu.:204446   Class :character   Class :character   Class :character   1st Qu.:22.00   Class :character   1st Qu.:177.0  </span><br><span class="line"> Median :226165   Mode  :character   Mode  :character   Mode  :character   Median :25.00   Mode  :character   Median :181.0  </span><br><span class="line"> Mean   :219739                                                            Mean   :25.28                      Mean   :181.4  </span><br><span class="line"> 3rd Qu.:240796                                                            3rd Qu.:29.00                      3rd Qu.:186.0  </span><br><span class="line"> Max.   :252905                                                            Max.   :42.00                      Max.   :205.0  </span><br><span class="line">                                                                                                                             </span><br><span class="line">   weight_kg      nationality            club              overall        potential       value_eur            wage_eur     </span><br><span class="line"> Min.   : 50.00   Length:18278       Length:18278       Min.   :48.00   Min.   :49.00   Min.   :        0   Min.   :     0  </span><br><span class="line"> 1st Qu.: 70.00   Class :character   Class :character   1st Qu.:62.00   1st Qu.:67.00   1st Qu.:   325000   1st Qu.:  1000  </span><br><span class="line"> Median : 75.00   Mode  :character   Mode  :character   Median :66.00   Median :71.00   Median :   700000   Median :  3000  </span><br><span class="line"> Mean   : 75.28                                         Mean   :66.24   Mean   :71.55   Mean   :  2484038   Mean   :  9457  </span><br><span class="line"> 3rd Qu.: 80.00                                         3rd Qu.:71.00   3rd Qu.:75.00   3rd Qu.:  2100000   3rd Qu.:  8000  </span><br><span class="line"> Max.   :110.00                                         Max.   :94.00   Max.   :95.00   Max.   :105500000   Max.   :565000  </span><br><span class="line">                                                                                                                            </span><br><span class="line"> player_positions   preferred_foot     international_reputation   weak_foot      skill_moves     work_rate          body_type        </span><br><span class="line"> Length:18278       Length:18278       Min.   :1.000            Min.   :1.000   Min.   :1.000   Length:18278       Length:18278      </span><br><span class="line"> Class :character   Class :character   1st Qu.:1.000            1st Qu.:3.000   1st Qu.:2.000   Class :character   Class :character  </span><br><span class="line"> Mode  :character   Mode  :character   Median :1.000            Median :3.000   Median :2.000   Mode  :character   Mode  :character  </span><br><span class="line">                                       Mean   :1.103            Mean   :2.944   Mean   :2.368                                        </span><br><span class="line">                                       3rd Qu.:1.000            3rd Qu.:3.000   3rd Qu.:3.000                                        </span><br><span class="line">                                       Max.   :5.000            Max.   :5.000   Max.   :5.000                                        </span><br><span class="line">                                                                                                                                     </span><br><span class="line">  real_face         release_clause_eur  player_tags        team_position      team_jersey_number loaned_from           joined         </span><br><span class="line"> Length:18278       Min.   :    13000   Length:18278       Length:18278       Min.   : 1.0       Length:18278       Length:18278      </span><br><span class="line"> Class :character   1st Qu.:   563000   Class :character   Class :character   1st Qu.: 9.0       Class :character   Class :character  </span><br><span class="line"> Mode  :character   Median :  1200000   Mode  :character   Mode  :character   Median :17.0       Mode  :character   Mode  :character  </span><br><span class="line">                    Mean   :  4740717                                         Mean   :20.1                                            </span><br><span class="line">                    3rd Qu.:  3700000                                         3rd Qu.:27.0                                            </span><br><span class="line">                    Max.   :195800000                                         Max.   :99.0                                            </span><br><span class="line">                    NA&#x27;s   :1298                                              NA&#x27;s   :240                                             </span><br><span class="line"> contract_valid_until nation_position    nation_jersey_number      pace         shooting       passing        dribbling    </span><br><span class="line"> Min.   :2019         Length:18278       Min.   : 1.00        Min.   :24.0   Min.   :15.0   Min.   :24.00   Min.   :23.00  </span><br><span class="line"> 1st Qu.:2020         Class :character   1st Qu.: 6.00        1st Qu.:61.0   1st Qu.:42.0   1st Qu.:50.00   1st Qu.:57.00  </span><br><span class="line"> Median :2021         Mode  :character   Median :12.00        Median :69.0   Median :54.0   Median :58.00   Median :64.00  </span><br><span class="line"> Mean   :2021                            Mean   :12.12        Mean   :67.7   Mean   :52.3   Mean   :57.23   Mean   :62.53  </span><br><span class="line"> 3rd Qu.:2022                            3rd Qu.:18.00        3rd Qu.:75.0   3rd Qu.:63.0   3rd Qu.:64.00   3rd Qu.:69.00  </span><br><span class="line"> Max.   :2026                            Max.   :30.00        Max.   :96.0   Max.   :93.0   Max.   :92.00   Max.   :96.00  </span><br><span class="line"> NA&#x27;s   :240                             NA&#x27;s   :17152        NA&#x27;s   :2036   NA&#x27;s   :2036   NA&#x27;s   :2036    NA&#x27;s   :2036   </span><br><span class="line">   defending         physic        gk_diving      gk_handling      gk_kicking     gk_reflexes       gk_speed     gk_positioning </span><br><span class="line"> Min.   :15.00   Min.   :27.00   Min.   :44.00   Min.   :42.00   Min.   :35.00   Min.   :45.00   Min.   :12.0    Min.   :41.00  </span><br><span class="line"> 1st Qu.:36.00   1st Qu.:59.00   1st Qu.:60.00   1st Qu.:58.00   1st Qu.:57.00   1st Qu.:60.75   1st Qu.:29.0    1st Qu.:58.00  </span><br><span class="line"> Median :56.00   Median :66.00   Median :65.00   Median :63.00   Median :61.00   Median :66.00   Median :39.0    Median :64.00  </span><br><span class="line"> Mean   :51.55   Mean   :64.88   Mean   :65.42   Mean   :63.15   Mean   :61.83   Mean   :66.39   Mean   :37.8    Mean   :63.38  </span><br><span class="line"> 3rd Qu.:65.00   3rd Qu.:72.00   3rd Qu.:70.00   3rd Qu.:68.00   3rd Qu.:66.00   3rd Qu.:72.00   3rd Qu.:46.0    3rd Qu.:69.00  </span><br><span class="line"> Max.   :90.00   Max.   :90.00   Max.   :90.00   Max.   :92.00   Max.   :93.00   Max.   :92.00   Max.   :65.0    Max.   :91.00  </span><br><span class="line"> NA&#x27;s   :2036    NA&#x27;s   :2036    NA&#x27;s   :16242   NA&#x27;s   :16242   NA&#x27;s   :16242   NA&#x27;s   :16242   NA&#x27;s   :16242   NA&#x27;s   :16242  </span><br><span class="line"> </span><br><span class="line"> #数据过多，部分展示，下略。</span><br></pre></td></tr></table></figure>
</details>
</br>

<p>我们只需要取到部分有用的即可，大部分无意义的数据（例如player_url等）并不需要考虑。</p>
<p>所以我们现在的任务是整理数据，把有用的部分从完整的数据集里取出，单独组合在一起，这样有利于更方便地训练我们的模型。</p>
<p>初步考虑后，我挑选了以下数据：</p>
<ul>
<li>‘height_cm’,’weight_kg’ <strong>身高、体重的基本信息</strong></li>
<li>‘skill_moves’,’pace’,’shooting’,’passing’,’dribbling’,’defending’,’physic’ <strong>传球，射门等技术水平</strong></li>
<li>‘gk_diving’,’gk_handling’,’gk_kicking’,’gk_reflexes’,’gk_speed’,’gk_positioning’ <strong>门将技术水平</strong></li>
<li>‘overall’,’potential’,’wage_eur’ <strong>能力值，潜力，年薪等参考数值</strong></li>
<li>‘value_eur’ <strong>身价本身，用于训练的最关键数据</strong></li>
</ul>
<p>接下来，出于逻辑性的考虑，我们应该优先对这些数据进行初步的相关性分析。</p>
<p>如果直接处理这些数据，会出现一个问题：部分内容无法被正确分析，显示出问号。</p>
<p><img src="https://markdown.liuchengtu.com/work/uploads/upload_8392ebc0bd98a47a55bb22d42b7af006.jpg"></p>
<p>根据对图像中出错区域的分析，这可能是由于数据缺失导致的。</p>
<p>在这里我优先怀疑是否存在数据集质量较低，数据不完全的情况。</p>
<p>输入代码如下查看球员传球这一项的数据：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">head (short_name)</span><br><span class="line">head (passing)</span><br></pre></td></tr></table></figure>
<p>得到结果如下：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&gt; head (short_name)</span><br><span class="line">[1] &quot;L. Messi&quot;          &quot;Cristiano Ronaldo&quot; &quot;Neymar Jr&quot;         &quot;J. Oblak&quot;         </span><br><span class="line">[5] &quot;E. Hazard&quot;         &quot;K. De Bruyne&quot;     </span><br><span class="line">&gt; head (passing)</span><br><span class="line">[1] 92 82 87 NA 86 92</span><br></pre></td></tr></table></figure>
<p>在返回结果中，我们发现 “J. Oblak”这位球员没有’’passing’’数据，因为奥布拉克是效力于马德里竞技的门将。作为门将，他在游戏里的任务只是守门，只有门将特有的部分属性。他并没有被设置传球数据，所以这一项设为NA，如果直接对数据进行处理就会出现不可避免的错误。</p>
<p>同理，梅西也不会有’’gk_positioning’’数据，因为他根本不会守门，也不会有门将站位的数据，如果直接对他进行处理，也会在门将的数据上出相同的错。</p>
<p>对于这个问题，我的解决方案是把门将和非门将球员区分开，因为这两个位置的量化数据是不一样的。</p>
<p>所以我给出代码如下：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">#处理非门将有效数据，无关紧要的数据去除</span><br><span class="line">data &lt;- df[,c(&#x27;height_cm&#x27;,&#x27;weight_kg&#x27;,&#x27;overall&#x27;,&#x27;potential&#x27;,&#x27;value_eur&#x27;,&#x27;release_clause_eur&#x27;,&#x27;wage_eur&#x27;,&#x27;skill_moves&#x27;,&#x27;pace&#x27;,&#x27;shooting&#x27;,&#x27;passing&#x27;,&#x27;dribbling&#x27;,&#x27;defending&#x27;,&#x27;physic&#x27;)] </span><br><span class="line">data &lt;- data[!is.na(data$passing),]  #守门员没有passing数据，这一行去掉所有passing为NA的球员</span><br><span class="line">corr_matrix &lt;- cor(data)</span><br><span class="line">corrplot(corr_matrix, method = &quot;square&quot;,diag = F, type = &quot;lower&quot;)</span><br><span class="line"></span><br><span class="line">#处理非门将有效数据，无关紧要的数据去除</span><br><span class="line">data_gk &lt;- df[,c(&#x27;height_cm&#x27;,&#x27;weight_kg&#x27;,&#x27;overall&#x27;,&#x27;potential&#x27;,&#x27;value_eur&#x27;,&#x27;release_clause_eur&#x27;,&#x27;wage_eur&#x27;,&#x27;gk_diving&#x27;,&#x27;gk_handling&#x27;,&#x27;gk_kicking&#x27;,&#x27;gk_reflexes&#x27;,&#x27;gk_speed&#x27;,&#x27;gk_positioning&#x27;)] </span><br><span class="line">data_gk &lt;- data_gk[!is.na(data_gk$gk_diving),] #同上，筛选门将。</span><br><span class="line">corr_matrix_gk &lt;- cor(data_gk)</span><br><span class="line">corrplot(corr_matrix_gk, method = &quot;square&quot;,diag = F, type = &quot;lower&quot;)</span><br></pre></td></tr></table></figure>
<p>这段代码筛选了门将球员和非门将球员，为他们各自保留了有价值的数据。</p>
<p><code>cor()</code>函数用于计算变量之间的相关系数，生成一个由变量之间的相关性组成的方阵，其中对角线上的元素表示每个变量与自身之间的相关性（始终为1），而非对角线的元素则表示每对变量之间的相关性。</p>
<p><code>corrplot()</code>函数用于创建相关性矩阵的图。<code>method = &quot;square&quot;</code>参数指定图应该是方形的，<code>diag = F</code>参数则指示函数从绘图中删除对角线元素（因为它们始终为1）。最后，<code>type = &quot;lower&quot;</code>参数指定只显示相关性矩阵的下三角部分，因为矩阵是对称的，上三角部分是重复的。</p>
<p> 可视化结果为下图：<br> <img src="https://markdown.liuchengtu.com/work/uploads/upload_2227341ba9f67ea1b8671e6c1b06f71a.jpg"></p>
<p>越蓝的部分相关性越强，越红的部分相关性越弱。</p>
<p>不难发现所有选中的数据与身价 ‘value_eur’的交点都是蓝色，正相关。</p>
<h3 id="用线性回归模型建模"><a href="#用线性回归模型建模" class="headerlink" title="用线性回归模型建模"></a>用线性回归模型建模</h3><p>现在开始建模，我先选用线性回归模型，对非门将球员进行处理。</p>
<p>首先需要把数据拆分为训练集和实验集，在训练集训练模型后，用实验集的数据去测试模型，这样可以有效评估模型精度。我们把数据拆分成70%训练集，30%实验集。</p>
<p>为了让结果可复现，还需要设置一个种子保证在这个种子下的每次随机生成结果都一样。</p>
<p>代码如下：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">set.seed(313)</span><br><span class="line">ind &lt;- sample(2,nrow(data),replace=T,prob=c(0.7,0.3))</span><br><span class="line">data_train &lt;- data[ind == 1,]</span><br><span class="line">data_test &lt;- data[ind == 2,]</span><br></pre></td></tr></table></figure>
<p>这段代码用于将一个数据集 data 划分为训练集和测试集。</p>
<p>具体来说，set.seed(313) 是设置一个随机种子，以确保每次运行代码时都能得到相同的随机结果。ind &lt;- sample(2,nrow(data),replace&#x3D;T,prob&#x3D;c(0.7,0.3)) 则是生成一个长度为 nrow(data)的随机数向量，其中每个元素的取值为 1 或 2，概率分别为 0.7 和 0.3，表示将数据集中的样本随机划分为训练集和测试集。其中，sample() 函数用于生成随机数向量，replace&#x3D;T 表示采样时可以重复抽样，prob&#x3D;c(0.7,0.3) 表示生成的随机数向量中取值为 1 和 2的概率分别为 0.7 和 0.3。</p>
<p>接下来，data_train &lt;- data[ind &#x3D;&#x3D; 1,] 将数据集中随机取值为 1的样本作为训练集，赋值给 data_train 变量。而 data_test &lt;- data[ind &#x3D;&#x3D; 2,] 则将数据集中随机取值为 2的样本作为测试集，赋值给 data_test 变量。</p>
<p>通过将数据集划分为训练集和测试集，我们可以使用训练集来训练模型，并使用测试集来评估模型的性能。这样可以更好地估计模型对未知数据的预测能力，并避免模型在训练数据上过拟合的问题。</p>
<p>接下来，把数据导入，得到模型<code>data_model</code>。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">data_model &lt;- lm(value_eur~ height_cm + weight_kg + overall + potential + wage_eur + skill_moves + pace + shooting + passing + dribbling + defending + physic,data_train)</span><br></pre></td></tr></table></figure>
<p>接下来使用这个模型，对测试集里的数据进行预测，用<code>data_pred</code>接收预测的结果。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">data_pred = predict(data_model,data_test)</span><br></pre></td></tr></table></figure>

<p>为了有效评估模型的准确度，我们用真实值减去预测值得到误差<code>data_error</code>。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">data_actual &lt;- data_test$value_eur</span><br><span class="line">data_error &lt;- data_actual - data_pred</span><br></pre></td></tr></table></figure>

<h3 id="误差可视化分析"><a href="#误差可视化分析" class="headerlink" title="误差可视化分析"></a>误差可视化分析</h3><p>接下来，我们对误差进行可视化处理。</p>
<p>如果直接画图，会出现这样的结果：<br><img src="https://markdown.liuchengtu.com/work/uploads/upload_9e83209029af1f71bfdce77b900a87ef.jpg"></p>
<p>这不是能获取有效信息的图。显然x轴范围太大了，是部分极端数据导致的。</p>
<p>反复试错后，确定范围为±1500000，这样的图牺牲了304个极端数据。而测试集样本总量为4851个，去除了约6%的数据，我认为这是可以接受的误差。</p>
<p>代码如下：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">ggplot(data.frame(data_error), aes(x = data_error, fill = (data_error &gt; 0))) +</span><br><span class="line">  geom_histogram(binwidth = 50000, color = &quot;black&quot;) +</span><br><span class="line">  scale_x_continuous(limits = c(-1500000, 1500000)) +</span><br><span class="line">  scale_fill_manual(values = c(&quot;red&quot;, &quot;green&quot;)) +  # 手动指定颜色</span><br><span class="line">  xlab(&quot;Error&quot;) + ylab(&quot;Count&quot;) </span><br></pre></td></tr></table></figure>
<p>具体来说，data.frame(data_error) 将一个包含模型误差的向量 data_error 转换为数据框（data frame）格式，并将其作为 ggplot() 函数的数据源。aes(x &#x3D; data_error, fill &#x3D; (data_error &gt; 0)) 则指定了直方图的变量和填充颜色，其中 x 参数指定了直方图的横轴变量为 data_error，而 fill 参数则根据 data_error的取值是否大于 0 来填充直方图的颜色。</p>
<p>接下来，geom_histogram(binwidth &#x3D; 50000, color &#x3D; “black”) 添加了一个直方图层，其中 binwidth 参数指定了直方图的柱宽为 50000，color 参数指定了柱子的边框颜色为黑色。</p>
<p>scale_x_continuous(limits &#x3D; c(-1500000, 1500000)) 和 scale_fill_manual(values &#x3D; c(“red”, “green”)) 分别指定了直方图横轴的取值范围和填充颜色的取值范围。其中，limits 参数将横轴的取值范围限制在 -1500000 到 1500000 之间，values 参数手动指定了填充颜色为红色和绿色。</p>
<p>最后，xlab(“Error”) + ylab(“Count”) 分别指定了横轴和纵轴的标签为 “Error” 和 “Count”。</p>
<p>画出的图像如下：</p>
<p><img src="https://markdown.liuchengtu.com/work/uploads/upload_22016d1c271e94c28e37e6c473459af4.jpg"></p>
<p>可见大体符合正态分布的形式。</p>
<p>接下来绘制残差图，代码如下：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">plot(data_pred, data_error, xlab = &quot;Predicted Value&quot;, ylab = &quot;Residuals&quot;, xlim = c(-1000000, 1000000),ylim = c(-3000000, 3000000))</span><br><span class="line">abline(h = 0, col = &quot;red&quot;)</span><br></pre></td></tr></table></figure>
<p>图像如下：<br><img src="https://markdown.liuchengtu.com/work/uploads/upload_d9fe26b762be8a7ab50a2c1f2def76ea.jpg"></p>
<p>发现左侧误差普遍较高，通常意味着模型在预测较小的变量时出现了偏差。可是这里，模型居然给出了小于0的预测值，这是不可接受的，我们需要用ifelse语句修正。</p>
<p>补充代码如下：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">data_pred &lt;- ifelse(data_pred&lt;0,0,data_pred)</span><br></pre></td></tr></table></figure>

<p>接下来使用交叉验证，代码如下：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"># 创建一个交叉验证控制对象ctrl，指定交叉验证方法为&quot;cv&quot;，即k折交叉验证，k的值为10。</span><br><span class="line">ctrl &lt;- trainControl(method = &quot;cv&quot;, number = 10)</span><br><span class="line"># 进行交叉验证</span><br><span class="line">data_model_cv1 &lt;- train(value_eur ~., data = data_train, method = &quot;lm&quot;,trControl = ctrl)</span><br><span class="line"># 查看交叉验证结果</span><br><span class="line">data_model_cv1$results</span><br></pre></td></tr></table></figure>
<p>这里使用的k折交叉验证是其中最常用的一种。它将数据集分成k个大小相等的子集，然后重复k次。在每一次重复中，选择其中一个子集作为测试集，其余的k-1个子集作为训练集。然后对模型进行训练，并在测试集上进行测试，记录误差。这样就会得到k个评估分数，平均值可以作为模型的性能指标。这种方法可以有效地减少模型过拟合和欠拟合的可能性，从而提高模型的泛化能力。</p>
<p>得出结果：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">  intercept    RMSE  Rsquared     MAE RMSESD RsquaredSD    MAESD</span><br><span class="line">1      TRUE 2578957 0.7844251 1370050 316320 0.03640009 60225.02</span><br></pre></td></tr></table></figure>
<p>术语笔记记录：</p>
<ul>
<li>RMSE（Root Mean Squared Error）：均方根误差，是实际值与预测值之间误差的平方和的平均值的平方根。RMSE越小，代表模型的预测能力越好。</li>
<li>R-squared（R平方）：决定系数，是实际值与预测值之间的相关性的平方。R平方在0到1之间，越接近1代表模型的拟合程度越好。</li>
<li>MAE（Mean Absolute Error）：平均绝对误差，是实际值与预测值之间误差的绝对值的平均值。MAE越小，代表模型的预测能力越好。</li>
<li>RMSESD：RMSE的标准差，用于评估模型的泛化能力。</li>
<li>RsquaredSD：R平方的标准差，用于评估模型的稳定性。</li>
<li>MAESD：MAE的标准差，用于评估模型的稳定性和泛化能力。</li>
</ul>
<p>R值仅有0.78，均方根误差2578957，平均绝对误差1370050。</p>
<p>可以接受，我们仍然能做得更好。</p>
<h1 id="误差分析和修正"><a href="#误差分析和修正" class="headerlink" title="误差分析和修正"></a>误差分析和修正</h1><h3 id="采用数据的问题"><a href="#采用数据的问题" class="headerlink" title="采用数据的问题"></a>采用数据的问题</h3><p>上文提及，我采用了如下的数据。</p>
<ul>
<li>‘height_cm’,’weight_kg’ <strong>身高、体重的基本信息</strong></li>
<li>‘skill_moves’,’pace’,’shooting’,’passing’,’dribbling’,’defending’,’physic’ <strong>传球，射门等技术水平</strong></li>
<li>‘gk_diving’,’gk_handling’,’gk_kicking’,’gk_reflexes’,’gk_speed’,’gk_positioning’ <strong>门将技术水平</strong></li>
<li>‘overall’,’potential’,’wage_eur’ <strong>能力值，潜力，年薪等参考数值</strong></li>
<li>‘value_eur’ <strong>身价本身，用于训练的最关键数据</strong></li>
</ul>
<p>这些数据是否完全反映了球员的身价？基本信息已经完全录入，而还可以入手的地方就是侧面反映球员能力的’’参考数据’’。除能力值，潜力，年薪之外，我发现我在第一轮建模时忽略了一个数据：强制解约金。</p>
<p>其他球队可以通过支付这笔解约金来买断这名球员的合同，解约金一般高于该球员身价。数据集里梅西的解约金是1.9亿欧元，而某位不知名球员’’Mohammed Sagaf’’解约金只有可怜的7万欧元。所以我认为，球员的合同里存在的强制解约金可以间接反映这个球员的价值。</p>
<p>在训练模型时加入解约金这一项，代码如下：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">data &lt;- df[,c(&#x27;height_cm&#x27;,&#x27;weight_kg&#x27;,&#x27;overall&#x27;,&#x27;potential&#x27;,&#x27;value_eur&#x27;,&#x27;release_clause_eur&#x27;,&#x27;wage_eur&#x27;,&#x27;skill_moves&#x27;,&#x27;pace&#x27;,&#x27;shooting&#x27;,&#x27;passing&#x27;,&#x27;dribbling&#x27;,&#x27;defending&#x27;,&#x27;physic&#x27;)] </span><br><span class="line">data &lt;- data[!is.na(data$passing),]  #守门员没有passing数据</span><br><span class="line">corr_matrix &lt;- cor(data)</span><br><span class="line">corrplot(corr_matrix, method = &quot;square&quot;,diag = F, type = &quot;lower&quot;)</span><br></pre></td></tr></table></figure>

<p>如果直接处理，仍然会出现问号，如下图：<br><img src="https://markdown.liuchengtu.com/work/uploads/upload_523a0a7eed6fe7b9a8f1539f65418ede.jpg"><br>在上面的探究中，我们已经知道问号出现的原因是出现了空缺的数据。</p>
<p>检查数据集，代码如下：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">summary(data$release_clause_eur)</span><br></pre></td></tr></table></figure>
<p>结果如下：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"> Min.   1st Qu.    Median      Mean   3rd Qu.      Max.      NA&#x27;s </span><br><span class="line">18000    609000   1300000   4924714   4000000 195800000      1165 </span><br></pre></td></tr></table></figure>

<p>可见1165个球员的合同并没有加入解约金条款，所以解约金数据空缺。</p>
<p>现在有两个方法处理这些空缺的数据：</p>
<ul>
<li>去除所有空缺数据。</li>
<li>把空缺的部分用该项数据的平均值填补。</li>
</ul>
<p>这部分球员数量占比仅达到了7%左右，且水平参差不齐，用该项数据的平均值填补可能导致出现进一步的误差。处于严谨性，我们按之前建立线性回归模型的方法对这两种方法都进行一次测试，量化地对比两个方法。</p>
<h4 id="去除所有空缺数据"><a href="#去除所有空缺数据" class="headerlink" title="去除所有空缺数据"></a>去除所有空缺数据</h4><p>与先前的方法相比，添加代码如下：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">data &lt;- data[!is.na(data$release_clause_eur),]</span><br></pre></td></tr></table></figure>
<p>这个代码可以把所有空缺项全部去掉，接下来按之前的方法操作，最后再使用交叉验证。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"># 创建一个交叉验证控制对象ctrl，指定交叉验证方法为&quot;cv&quot;，即k折交叉验证，k的值为10。</span><br><span class="line">ctrl &lt;- trainControl(method = &quot;cv&quot;, number = 10)</span><br><span class="line"># 进行交叉验证</span><br><span class="line">data_model_cv1 &lt;- train(value_eur ~., data = data_train, method = &quot;lm&quot;,trControl = ctrl)</span><br><span class="line"># 查看交叉验证结果</span><br><span class="line">data_model_cv1$results</span><br></pre></td></tr></table></figure>

<p>得出结果：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">  intercept     RMSE  Rsquared      MAE   RMSESD RsquaredSD    MAESD</span><br><span class="line">1      TRUE 646712.3 0.9867474 289196.5 57692.47 0.00225056 11995.83</span><br></pre></td></tr></table></figure>
<p>可以发现，这里已经比原模型有了较明显的提升，在分析出更好的处理方法后，我们会对它们的结果进行可视化处理，有利于直观地分析差距。</p>
<h4 id="用平均值填补"><a href="#用平均值填补" class="headerlink" title="用平均值填补"></a>用平均值填补</h4><p>与先前的方法相比，添加代码如下：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">data$release_clause_eur[is.na(data$release_clause_eur)] &lt;- mean(data$release_clause_eur, na.rm = TRUE)</span><br></pre></td></tr></table></figure>
<p>这个把所有空缺项全部用解约金平均值填补。接下来按之前的方法操作，最后再使用交叉验证。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"># 创建一个交叉验证控制对象ctrl，指定交叉验证方法为&quot;cv&quot;，即k折交叉验证，k的值为10。</span><br><span class="line">ctrl &lt;- trainControl(method = &quot;cv&quot;, number = 10)</span><br><span class="line"># 进行交叉验证</span><br><span class="line">data_model_cv1 &lt;- train(value_eur ~., data = data_train, method = &quot;lm&quot;,trControl = ctrl)</span><br><span class="line"># 查看交叉验证结果</span><br><span class="line">data_model_cv1$results</span><br></pre></td></tr></table></figure>

<p>得出结果：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">  intercept    RMSE  Rsquared      MAE   RMSESD RsquaredSD    MAESD</span><br><span class="line">1      TRUE 1034079 0.9633106 454096.9 322250.3   0.022778 31027.41</span><br></pre></td></tr></table></figure>
<h4 id="可视化分析"><a href="#可视化分析" class="headerlink" title="可视化分析"></a>可视化分析</h4><p>评估思路非常简单，对比两组数据即可。首先把两组数据单独列出，代码如下：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">df1 &lt;- as.data.frame(data_model_cv1$results)</span><br><span class="line">df2 &lt;- as.data.frame(data_model_cv2$results)</span><br></pre></td></tr></table></figure>
<p>这段代码将 data_model_cv1 和 data_model_cv2 两个交叉验证模型的结果转换为数据框（data frame）格式，并分别赋值给了 df1 和 df2 两个变量。</p>
<p>先合并RMSE&#x2F;MAE数据，因为它们相近且远大于R方。然后绘图。代码如下：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"># 合并RMSE/MAE</span><br><span class="line">df &lt;- data.frame(Model = rep(c(&quot;Blank&quot;, &quot;Average&quot;), each = 2),</span><br><span class="line">                 Metric = rep(c(&quot;RMSE&quot;, &quot;MAE&quot;), 2),</span><br><span class="line">                 Value = c(df1$RMSE,df1$MAE, mean(df2$RMSE),mean(df2$MAE)))</span><br><span class="line"># 绘制关于RMSE/MAE的柱状图</span><br><span class="line">ggplot(df, aes(x = Metric, y = Value, fill = Model)) +</span><br><span class="line">  geom_bar(stat = &quot;identity&quot;, position = position_dodge()) +</span><br><span class="line">  labs(title = &quot;Comparison of Two Models&quot;,</span><br><span class="line">       x = &quot;Metric&quot;, y = &quot;Value&quot;, fill = &quot;Model&quot;)</span><br></pre></td></tr></table></figure>
<p>同理处理R方，代码如下：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"># 合并数据框，R方</span><br><span class="line">df &lt;- data.frame(Model = rep(c(&quot;Blank&quot;, &quot;Average&quot;), each = 1),</span><br><span class="line">                 Metric = rep(c(&#x27;Rsquared&#x27;), 2),</span><br><span class="line">                 Value = c(df1$Rsquared,mean(df2$Rsquared)))</span><br><span class="line"># 绘制关于R方的柱状图</span><br><span class="line">ggplot(df, aes(x = Metric, y = Value, fill = Model)) +</span><br><span class="line">  geom_bar(stat = &quot;identity&quot;, position = position_dodge()) +</span><br><span class="line">  labs(title = &quot;Comparison of Rsquared Two Models&quot;,</span><br><span class="line">       x = &quot;Metric&quot;, y = &quot;Value&quot;, fill = &quot;Model&quot;)</span><br></pre></td></tr></table></figure>
<p>得到的图像是：<br><img src="https://markdown.liuchengtu.com/work/uploads/upload_d34f67216a4e99f8c0b1b6fb7441180a.jpg"><br><img src="https://markdown.liuchengtu.com/work/uploads/upload_222e18fe48c69cdd74003d3229afd947.jpg"></p>
<p>可以清晰看出，“去除所有空缺数据”这一方法效果更好。</p>
<p>我们就采用这种方法建模。</p>
<h3 id="空缺数据的问题"><a href="#空缺数据的问题" class="headerlink" title="空缺数据的问题"></a>空缺数据的问题</h3><p>虽然我们解决了门将和非门将的能力值不同导致的问题，但是数据是否真的没有空缺仍然需要对数据集进行进一步的检查和分析。我在对最关键的数据‘value_eur’，即身价本身检查时发现了问题，代码如下：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">summary(data$value_eur)</span><br></pre></td></tr></table></figure>
<p>检查结果如下：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">Min.   1st Qu.    Median      Mean   3rd Qu.      Max. </span><br><span class="line">   0    325000    700000   2484038   2100000 105500000 </span><br></pre></td></tr></table></figure>
<p>可见身价的最低值是0，而我们的问题是：球员身价为0是否是建模时的可靠依据？</p>
<p>继续挖掘数据，查看身价为0的球员到底有哪些。代码如下：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">data[data$value_eur == 0,]</span><br></pre></td></tr></table></figure>

<p>输出结果如下：</p>
<details>

<summary>点击展开/收缩代码块</summary>
    
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line">    height_cm weight_kg overall potential value_eur wage_eur skill_moves pace shooting passing </span><br><span class="line">328        185        80      82        82         0        0           2   80       43      56        </span><br><span class="line">329        177        75      82        82         0        0           4   81       77      81        </span><br><span class="line">408        181        82      81        81         0        0           2   71       61      57        </span><br><span class="line">409        171        63      81        81         0        0           4   82       72      77        </span><br><span class="line">410        188        83      81        81         0        0           3   80       82      60        </span><br><span class="line">411        188        84      81        81         0        0           4   80       80      56        </span><br><span class="line">567        177        75      80        80         0        0           3   68       62      74        </span><br><span class="line">568        178        69      80        80         0        0           4   79       54      76        </span><br><span class="line">750        182        79      79        79         0        0           2   70       48      60        </span><br><span class="line">751        175        70      79        79         0        0           2   81       57      72        </span><br><span class="line">753        176        73      79        79         0        0           4   84       79      65       </span><br><span class="line">792        179        71      78        83         0        0           3   73       38      65        </span><br><span class="line">802        175        70      78        82         0        0           3   75       73      76        </span><br><span class="line">869        180        78      78        78         0    21000           3   36       51      67       </span><br><span class="line">889        183        80      78        78         0        0           2   59       49      64        </span><br><span class="line">918        196        91      78        78         0        0           3   65       76      67       </span><br><span class="line">990        168        65      78        78         0        0           4   87       58      70        </span><br><span class="line">991        177        75      78        78         0        0           3   78       51      69       </span><br><span class="line">992        174        71      78        78         0        0           4   80       73      76        </span><br><span class="line">1088       182        74      77        80         0        0           3   80       68      73        </span><br><span class="line">1161       184        74      77        77         0        0           3   73       76      63        </span><br><span class="line">1250       188        88      77        77         0        0           3   71       70      69        </span><br><span class="line">1251       178        71      77        77         0        0           4   80       68      77        </span><br><span class="line">1252       176        75      77        77         0        0           4   80       71      71   </span><br><span class="line">    </span><br><span class="line">#截取部分，下略。</span><br><span class="line">    </span><br><span class="line">    </span><br></pre></td></tr></table></figure>
</details>
</br>


<p>在输出结果里，存在大量能力值并不低的球员，他们的身价不应该为0。</p>
<p>对照数据集检查，在这份名单里出现的球员在那时都没有合同，正好处于自由身状态。换句话说，这个数据集里的自由球员身价都为0，这导致了误差的出现，所以我们需要处理自由身球员的身价。</p>
<p>我采取的方法是去除所有的自由球员，因为自由球员的数量并不大，仅有134个，比3.1中更少。而上面已经说明，去除所有自由球员效果更好。</p>
<p>代码如下：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">data_gk &lt;- data_gk[!(&#x27;value_eur&#x27; == 0),] #自由球员身价是0，无参考价值,应该去掉</span><br></pre></td></tr></table></figure>
<p>接下来按之前的方法评估模型，输出如下：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">  intercept    RMSE  Rsquared     MAE   RMSESD RsquaredSD    MAESD</span><br><span class="line">1      TRUE 2602833 0.7828398 1377350 224113.4 0.02685402 70124.29</span><br></pre></td></tr></table></figure>
<p>效果并不比原模型好多少，几乎一致。</p>
<h3 id="合二为一"><a href="#合二为一" class="headerlink" title="合二为一"></a>合二为一</h3><p>综上，我们的建模的代码如下：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">#按“去除所有空缺数据”处理球员数据，相比“赋予平均值”效果更好，接下来会证明 </span><br><span class="line">data &lt;- df[,c(&#x27;height_cm&#x27;,&#x27;weight_kg&#x27;,&#x27;overall&#x27;,&#x27;potential&#x27;,&#x27;value_eur&#x27;,&#x27;release_clause_eur&#x27;,&#x27;wage_eur&#x27;,&#x27;skill_moves&#x27;,&#x27;pace&#x27;,&#x27;shooting&#x27;,&#x27;passing&#x27;,&#x27;dribbling&#x27;,&#x27;defending&#x27;,&#x27;physic&#x27;)] </span><br><span class="line">data &lt;- data[!is.na(data$passing),]  #守门员没有passing数据，精准打击</span><br><span class="line">data &lt;- data[!is.na(data$release_clause_eur),]</span><br><span class="line"></span><br><span class="line">#分训练集和实验集</span><br><span class="line">set.seed(313)</span><br><span class="line">ind &lt;- sample(2,nrow(data),replace=T,prob=c(0.7,0.3))</span><br><span class="line">data_train &lt;- data[ind == 1,]</span><br><span class="line">data_test &lt;- data[ind == 2,]</span><br><span class="line">#建模</span><br><span class="line">data_model &lt;- lm(value_eur~ height_cm + weight_kg + overall + release_clause_eur + potential + wage_eur + skill_moves + pace + shooting + passing + dribbling + defending + physic,data_train)</span><br><span class="line">#获取误差</span><br><span class="line">data_pred = predict(data_model,data_test)</span><br><span class="line">data_pred &lt;- ifelse(data_pred&lt;0,0,data_pred)</span><br><span class="line">data_actual &lt;- data_test$value_eur</span><br><span class="line">data_error &lt;- data_actual - data_pred</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>输出代码如下：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"># 将评估结果单独列出</span><br><span class="line">df1 &lt;- as.data.frame(data_model_cv1$results)</span><br><span class="line">df2 &lt;- as.data.frame(data_model_cv2$results)</span><br><span class="line"></span><br><span class="line"># 合并RMSE/MAE</span><br><span class="line">df &lt;- data.frame(Model = rep(c(&quot;New Model&quot;,&quot;Old Model&quot;), each = 2),</span><br><span class="line">                 Metric = rep(c(&quot;RMSE&quot;, &quot;MAE&quot;), 2),</span><br><span class="line">                 Value = c(df1$RMSE,df1$MAE, mean(df2$RMSE),mean(df2$MAE)))</span><br><span class="line"># 绘制关于RMSE/MAE的柱状图</span><br><span class="line">ggplot(df, aes(x = Metric, y = Value, fill = Model)) +</span><br><span class="line">  geom_bar(stat = &quot;identity&quot;, position = position_dodge()) +</span><br><span class="line">  labs(title = &quot;Comparison of Two Models&quot;,</span><br><span class="line">       x = &quot;Metric&quot;, y = &quot;Value&quot;, fill = &quot;Model&quot;)</span><br><span class="line"></span><br><span class="line"># 合并数据框，R方</span><br><span class="line">df &lt;- data.frame(Model = rep(c( &quot;New Model&quot;,&quot;Old Model&quot;), each = 1),</span><br><span class="line">                 Metric = rep(c(&#x27;Rsquared&#x27;), 2),</span><br><span class="line">                 Value = c(df1$Rsquared,mean(df2$Rsquared)))</span><br><span class="line"># 绘制关于R方的柱状图</span><br><span class="line">ggplot(df, aes(x = Metric, y = Value, fill = Model)) +</span><br><span class="line">  geom_bar(stat = &quot;identity&quot;, position = position_dodge()) +</span><br><span class="line">  labs(title = &quot;Comparison of Rsquared Two Models&quot;,</span><br><span class="line">       x = &quot;Metric&quot;, y = &quot;Value&quot;, fill = &quot;Model&quot;)</span><br></pre></td></tr></table></figure>


<p>结果是：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">  intercept     RMSE  Rsquared      MAE   RMSESD RsquaredSD    MAESD</span><br><span class="line">1      TRUE 646712.3 0.9867474 289196.5 57692.47 0.00225056 11995.83</span><br></pre></td></tr></table></figure>

<p>去除自由球员后，模型精度并未变化。</p>
<p>现在的模型和原模型对比如下：<br><img src="https://markdown.liuchengtu.com/work/uploads/upload_8c33b4b4bdcebfd8089383186db35d88.jpg"><br><img src="https://markdown.liuchengtu.com/work/uploads/upload_9610e824d56521657faaf9e881e6579f.jpg"></p>
<p>好，那现在我的评价是：薄纱。</p>
<h1 id="与决策树模型对比"><a href="#与决策树模型对比" class="headerlink" title="与决策树模型对比"></a>与决策树模型对比</h1><h3 id="决策树模型建模"><a href="#决策树模型建模" class="headerlink" title="决策树模型建模"></a>决策树模型建模</h3><p>决策树模型的建立过程与线性回归模型很像，我们导入的数据保持先前发现的最好配置，即“去除自由球员”，“去除无解约金球员”。这样不仅保证了模型精度，也和线性回归模型一致。</p>
<p>建模过程的代码如下：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"># 划分训练集和测试集</span><br><span class="line">set.seed(313)</span><br><span class="line">ind &lt;- sample(2, nrow(data), replace = TRUE, prob = c(0.7, 0.3))</span><br><span class="line">data_train &lt;- data[ind == 1, ]</span><br><span class="line">data_test &lt;- data[ind == 2, ]</span><br><span class="line"></span><br><span class="line"># 构建决策树模型</span><br><span class="line">data_model &lt;- rpart(value_eur ~ height_cm + weight_kg + overall + release_clause_eur + potential + wage_eur + skill_moves + pace + shooting + passing + dribbling + defending + physic, data = data_train)</span><br><span class="line"></span><br><span class="line"># 对测试集进行预测</span><br><span class="line">data_pred &lt;- predict(data_model, data_test)</span><br><span class="line">data_pred &lt;- ifelse(data_pred&lt;0,0,data_pred)</span><br><span class="line"></span><br><span class="line"># 计算预测误差</span><br><span class="line">data_actual &lt;- data_test$value_eur</span><br><span class="line">data_error &lt;- data_actual - data_pred</span><br></pre></td></tr></table></figure>
<h3 id="误差可视化分析-1"><a href="#误差可视化分析-1" class="headerlink" title="误差可视化分析"></a>误差可视化分析</h3><p>同理，代码如下：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"># 绘制误差直方图，限制误差范围为±1000000</span><br><span class="line">ggplot(data.frame(data_error), aes(x = data_error, fill = (data_error &gt; 0))) +</span><br><span class="line">  geom_histogram(binwidth = 50000, color = &quot;black&quot;) +</span><br><span class="line">  scale_x_continuous(limits = c(-1000000, 1000000)) +</span><br><span class="line">  scale_fill_manual(values = c(&quot;red&quot;, &quot;green&quot;)) +</span><br><span class="line">  xlab(&quot;Error&quot;) + ylab(&quot;Count&quot;) </span><br></pre></td></tr></table></figure>
<p>得到图像如下：<br><img src="https://markdown.liuchengtu.com/work/uploads/upload_eb4658f319a88e12e8ba4953b2850e29.jpg"></p>
<p>看起来略抽象。</p>
<h3 id="与线性回归模型对比"><a href="#与线性回归模型对比" class="headerlink" title="与线性回归模型对比"></a>与线性回归模型对比</h3><p>代码与3.1近似，需要注意的是，决策树模型使用交叉验证得到了三组结果，需要用平均值处理。如下：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"># 将评估结果转换为数据框</span><br><span class="line">df1 &lt;- as.data.frame(data_model_cv1$results)</span><br><span class="line">df2 &lt;- as.data.frame(data_model_cv2$results)</span><br><span class="line"></span><br><span class="line"># 合并数据框，RMSE/MAE</span><br><span class="line">df &lt;- data.frame(Model = rep(c(&quot;Linear Regression&quot;, &quot;Decision Tree&quot;), each = 2),</span><br><span class="line">                 Metric = rep(c(&quot;RMSE&quot;, &quot;MAE&quot;), 2),</span><br><span class="line">                 Value = c(df1$RMSE,df1$MAE, mean(df2$RMSE),mean(df2$MAE)))</span><br><span class="line"># 绘制关于RMSE/MAE的柱状图</span><br><span class="line">ggplot(df, aes(x = Metric, y = Value, fill = Model)) +</span><br><span class="line">  geom_bar(stat = &quot;identity&quot;, position = position_dodge()) +</span><br><span class="line">  labs(title = &quot;Comparison of Evaluation Metrics between Two Models&quot;,</span><br><span class="line">       x = &quot;Metric&quot;, y = &quot;Value&quot;, fill = &quot;Model&quot;)</span><br><span class="line"></span><br><span class="line"># 合并数据框，R方</span><br><span class="line">df &lt;- data.frame(Model = rep(c(&quot;Linear Regression&quot;, &quot;Decision Tree&quot;), each = 1),</span><br><span class="line">                 Metric = rep(c(&#x27;Rsquared&#x27;), 2),</span><br><span class="line">                 Value = c(df1$Rsquared,mean(df2$Rsquared)))</span><br><span class="line"># 绘制关于R方的柱状图</span><br><span class="line">ggplot(df, aes(x = Metric, y = Value, fill = Model)) +</span><br><span class="line">  geom_bar(stat = &quot;identity&quot;, position = position_dodge()) +</span><br><span class="line">  labs(title = &quot;Comparison of Rsquared Two Models&quot;,</span><br><span class="line">       x = &quot;Metric&quot;, y = &quot;Value&quot;, fill = &quot;Model&quot;)</span><br></pre></td></tr></table></figure>



<p>得到图像如下：<br><img src="https://markdown.liuchengtu.com/work/uploads/upload_452e2800ebcfc7c52d4880301559a044.jpg"><br><img src="https://markdown.liuchengtu.com/work/uploads/upload_64d81a8736541af351b41fdb957c01d4.jpg"></p>
<p>甚至不如原模型，决策树你就是逊啊。</p>
<h1 id="建模总结"><a href="#建模总结" class="headerlink" title="建模总结"></a>建模总结</h1><p>最终，我的模型效果如下:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">  intercept     RMSE  Rsquared      MAE   RMSESD RsquaredSD    MAESD</span><br><span class="line">1      TRUE 646712.3 0.9867474 289196.5 57692.47 0.00225056 11995.83</span><br></pre></td></tr></table></figure>
<p>预测误差直方图：<br><img src="https://markdown.liuchengtu.com/work/uploads/upload_de1572f4f9786f96b5c8af5b2d20f737.jpg"></p>
<p>残差图：<br><img src="https://markdown.liuchengtu.com/work/uploads/upload_d571be2ca196dc1af770d8d2ba107a8e.jpg"></p>
<p>可见已经较为贴近直线，拟合效果较好。</p>
<p>建模工作结束，关山难越今日越。</p>
</article><div class="tag_share"><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/%E6%95%B0%E6%8D%AE%E7%A7%91%E5%AD%A6/">数据科学</a></div><div class="post_share"><div class="social-share" data-image="/img/R_FIFA.jpg" data-sites="facebook,twitter,wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdnjs.sourcegcdn.com/ajax/libs/social-share.js/1.0.16/css/share.min.css" media="print" onload="this.media='all'"><script src="https://cdnjs.sourcegcdn.com/ajax/libs/social-share.js/1.0.16/js/social-share.min.js" defer></script></div></div><div class="end is-center">end</div><div id="post-comment"><div class="comment-head is-center"><div class="comment-headline"><span> 评论</span></div></div><div class="comment-wrap"><div><div class="vcomment" id="vcomment"></div></div></div></div></div><div class="aside-content" id="aside-content"><div class="card-widget card-info"><div class="card-info-avatar is-center"><img class="avatar-img" src="/img/head_sculpture.jpg" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"/><div class="author-info__name">L1ttleQing</div><div class="author-info__description">越悲怆的时候我越想嬉皮</div></div><div class="card-info-data"><div class="card-info-data-item is-center"><a href="/archives/"><div class="headline">文章</div><div class="length-num">34</div></a></div><div class="card-info-data-item is-center"><a href="/tags/"><div class="headline">标签</div><div class="length-num">5</div></a></div><div class="card-info-data-item is-center"><a href="/categories/"><div class="headline">分类</div><div class="length-num">2</div></a></div></div><a class="button--animated" id="card-info-btn" target="_blank" rel="noopener" href="https://github.com/L1ttleQing"><i class="fab fa-github"></i><span>主页</span></a><div class="card-info-social-icons is-center"><a class="social-icon" href="https://github.com/L1ttleQing" target="_blank" title="fab fa-github"></a><a class="social-icon" href="tencent://AddContact/?fromId=45&amp;fromSubId=1&amp;subcmd=all&amp;uin=820314438&amp;website=www.oicqzone.com" target="_blank" title="fab fa-qq"></a><a class="social-icon" href="mailto:820314438@qq.com" target="_blank" title="fas fa-envelope-open-text"></a><a class="social-icon" href="https://space.bilibili.com/26528101" target="_blank" title="fab fa-bilibili"></a><a class="social-icon" href="weixin://dl/w19183660929" target="_blank" title="fab fa-weixin"></a></div></div><div class="card-widget card-announcement"><div class="item-headline"><i class="fas fa-bullhorn card-announcement-animation"></i><span>公告</span></div><div class="announcement_content">重构了界面，去除冗余结构，哦耶！</div></div><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><i class="fas fa-stream"></i><span>目录</span></div><div class="toc-content"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#%E5%87%86%E5%A4%87%E5%B7%A5%E4%BD%9C"><span class="toc-number">1.</span> <span class="toc-text">准备工作</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E5%88%9D%E6%AD%A5%E5%BB%BA%E6%A8%A1"><span class="toc-number">2.</span> <span class="toc-text">初步建模</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%A4%84%E7%90%86%E6%95%B0%E6%8D%AE"><span class="toc-number">2.0.1.</span> <span class="toc-text">处理数据</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%94%A8%E7%BA%BF%E6%80%A7%E5%9B%9E%E5%BD%92%E6%A8%A1%E5%9E%8B%E5%BB%BA%E6%A8%A1"><span class="toc-number">2.0.2.</span> <span class="toc-text">用线性回归模型建模</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%AF%AF%E5%B7%AE%E5%8F%AF%E8%A7%86%E5%8C%96%E5%88%86%E6%9E%90"><span class="toc-number">2.0.3.</span> <span class="toc-text">误差可视化分析</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E8%AF%AF%E5%B7%AE%E5%88%86%E6%9E%90%E5%92%8C%E4%BF%AE%E6%AD%A3"><span class="toc-number">3.</span> <span class="toc-text">误差分析和修正</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%87%87%E7%94%A8%E6%95%B0%E6%8D%AE%E7%9A%84%E9%97%AE%E9%A2%98"><span class="toc-number">3.0.1.</span> <span class="toc-text">采用数据的问题</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%8E%BB%E9%99%A4%E6%89%80%E6%9C%89%E7%A9%BA%E7%BC%BA%E6%95%B0%E6%8D%AE"><span class="toc-number">3.0.1.1.</span> <span class="toc-text">去除所有空缺数据</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%94%A8%E5%B9%B3%E5%9D%87%E5%80%BC%E5%A1%AB%E8%A1%A5"><span class="toc-number">3.0.1.2.</span> <span class="toc-text">用平均值填补</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%8F%AF%E8%A7%86%E5%8C%96%E5%88%86%E6%9E%90"><span class="toc-number">3.0.1.3.</span> <span class="toc-text">可视化分析</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%A9%BA%E7%BC%BA%E6%95%B0%E6%8D%AE%E7%9A%84%E9%97%AE%E9%A2%98"><span class="toc-number">3.0.2.</span> <span class="toc-text">空缺数据的问题</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%90%88%E4%BA%8C%E4%B8%BA%E4%B8%80"><span class="toc-number">3.0.3.</span> <span class="toc-text">合二为一</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E4%B8%8E%E5%86%B3%E7%AD%96%E6%A0%91%E6%A8%A1%E5%9E%8B%E5%AF%B9%E6%AF%94"><span class="toc-number">4.</span> <span class="toc-text">与决策树模型对比</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%86%B3%E7%AD%96%E6%A0%91%E6%A8%A1%E5%9E%8B%E5%BB%BA%E6%A8%A1"><span class="toc-number">4.0.1.</span> <span class="toc-text">决策树模型建模</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%AF%AF%E5%B7%AE%E5%8F%AF%E8%A7%86%E5%8C%96%E5%88%86%E6%9E%90-1"><span class="toc-number">4.0.2.</span> <span class="toc-text">误差可视化分析</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%B8%8E%E7%BA%BF%E6%80%A7%E5%9B%9E%E5%BD%92%E6%A8%A1%E5%9E%8B%E5%AF%B9%E6%AF%94"><span class="toc-number">4.0.3.</span> <span class="toc-text">与线性回归模型对比</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E5%BB%BA%E6%A8%A1%E6%80%BB%E7%BB%93"><span class="toc-number">5.</span> <span class="toc-text">建模总结</span></a></li></ol></div></div><div class="card-widget card-recent-post"><div class="item-headline"><i class="fas fa-history"></i><span>最新文章</span></div><div class="aside-list"><div class="aside-list-item"><a class="thumbnail" href="/2025/10/31/%E8%B9%89%E8%B7%8E%E5%8E%BB/" title="蹉跎去"><img src="/img/ctqq.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="蹉跎去"/></a><div class="content"><a class="title" href="/2025/10/31/%E8%B9%89%E8%B7%8E%E5%8E%BB/" title="蹉跎去">蹉跎去</a><time datetime="2025-10-31T03:09:00.000Z" title="发表于 2025-10-31 11:09:00">2025-10-31</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2025/02/22/%E5%AE%B9%E6%98%93%E8%8E%AB%E7%9B%B8%E5%82%AC/" title="容易莫相催"><img src="/img/ctq.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="容易莫相催"/></a><div class="content"><a class="title" href="/2025/02/22/%E5%AE%B9%E6%98%93%E8%8E%AB%E7%9B%B8%E5%82%AC/" title="容易莫相催">容易莫相催</a><time datetime="2025-02-22T03:09:00.000Z" title="发表于 2025-02-22 11:09:00">2025-02-22</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2025/02/08/1Springboot/" title="笔记 SpringBoot"><img src="/img/springboot.png" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="笔记 SpringBoot"/></a><div class="content"><a class="title" href="/2025/02/08/1Springboot/" title="笔记 SpringBoot">笔记 SpringBoot</a><time datetime="2025-02-08T08:09:00.000Z" title="发表于 2025-02-08 16:09:00">2025-02-08</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2025/01/28/1mybatis/" title="笔记 Mybatis/plus"><img src="/img/mb.png" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="笔记 Mybatis/plus"/></a><div class="content"><a class="title" href="/2025/01/28/1mybatis/" title="笔记 Mybatis/plus">笔记 Mybatis/plus</a><time datetime="2025-01-28T08:09:00.000Z" title="发表于 2025-01-28 16:09:00">2025-01-28</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2025/01/22/%E8%8B%8D%E8%8C%AB%E6%9D%A5%E6%97%B6/" title="苍茫来时"><img src="/img/cmls.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="苍茫来时"/></a><div class="content"><a class="title" href="/2025/01/22/%E8%8B%8D%E8%8C%AB%E6%9D%A5%E6%97%B6/" title="苍茫来时">苍茫来时</a><time datetime="2025-01-21T19:09:10.000Z" title="发表于 2025-01-22 03:09:10">2025-01-22</time></div></div></div></div></div></div></main><div id="content_rightside"><div id="rightside-toc"><div class="toc-box"></div></div></div></div><footer id="footer"><div class="wordcount"><span>L1ttleQing已经写了207.5k字。</span></br><span>相当于写完了一本巴金的《寒夜》</span></div><div class="footer-content"><div style="font-size: 0.7rem"><span id="timeDate">载入天数...</span><span> </span><span id="times">载入时分秒...</span><script src="/js/add/duration.js"></script></div></div></footer></div><div id="rightside"></div><div id="local-search"><div class="search-dialog"><div class="search-dialog__title" id="local-search-title">Local search</div><div id="local-input-panel"><div id="local-search-input"><div class="local-search-box"><input class="local-search-box--input" placeholder="Search for Posts" type="text"/></div></div></div><hr/><div id="local-search-results"></div><span class="search-close-button"><i class="fas fa-times"></i></span></div><div id="search-mask"></div></div><div><script src="/js/utils.js"></script><script src="/js/main.js"></script><script src="/js/search/local-search.js"></script><div class="js-pjax"><script>function loadValine () {
  function initValine () {
    let initData = {
      el: '#vcomment',
      appId: 'fymxlpNGPzfrWOWcfY71mwBV-gzGzoHsz',
      appKey: 'I0VLNN103CyrzIXBIh7eFsH5',
      placeholder: '昵称为必填项...',
      avatar: 'mp',
      meta: 'nick,mail'.split(','),
      pageSize: '10',
      lang: 'en',
      recordIP: true,
      serverURLs: '',
      emojiCDN: '',
      emojiMaps: "",
      enableQQ: true,
      path: window.location.pathname,
    }

    if (true) { 
      initData.requiredFields= ('nick,mail'.split(','))
    }
    
    if (false) {
      const otherData = false
      initData = Object.assign(initData, otherData)
    }
    
    const valine = new Valine(initData)
  }

  if (typeof Valine === 'function') initValine() 
  else getScript('https://cdn1.tianli0.top/npm/valine/dist/Valine.min.js').then(initValine)
}

if ('Valine' === 'Valine' || !true) {
  if (true) btf.loadComment(document.getElementById('vcomment'),loadValine)
  else setTimeout(loadValine, 0)
} else {
  function loadOtherComment () {
    loadValine()
  }
}</script></div><script async src="//at.alicdn.com/t/font_2749059_1lswi5j6yqg.js"></script><script src="/js/add/nav.js"></script><script src="/js/add/leftsidemenu.js"></script><script defer="defer" id="fluttering_ribbon" mobile="false" src="https://cdn1.tianli0.top/npm/butterfly-extsrc@1/dist/canvas-fluttering-ribbon.min.js"></script><script src="https://cdn1.tianli0.top/npm/butterfly-extsrc@1/dist/activate-power-mode.min.js"></script><script>POWERMODE.colorful = true;
POWERMODE.shake = false;
POWERMODE.mobile = false;
document.body.addEventListener('input', POWERMODE);
</script><script async data-pjax src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script></div></body></html>